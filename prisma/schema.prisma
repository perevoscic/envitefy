generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  id                 String           @id @default(uuid()) @db.Uuid
  email              String           @unique
  first_name         String?          @db.VarChar(255)
  last_name          String?          @db.VarChar(255)
  preferred_provider String?          @db.VarChar(32)
  subscription_plan  String?          @db.VarChar(32)
  onboarding_required Boolean?        @default(false)
  onboarding_persona String?          @db.VarChar(32)
  onboarding_completed_at DateTime?   @db.Timestamptz(6)
  onboarding_prompt_dismissed_at DateTime? @db.Timestamptz(6)
  feature_visibility Json?
  password_hash      String?
  created_at         DateTime         @default(now()) @db.Timestamptz(6)
  oauth_tokens       oauth_tokens[]
  theme_override     theme_overrides?

  @@map("users")
}

model oauth_tokens {
  id            String   @id @default(uuid()) @db.Uuid
  email         String
  user_id       String?  @db.Uuid
  provider      String
  refresh_token String
  updated_at    DateTime @updatedAt @db.Timestamptz(6)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  user          users?   @relation(fields: [user_id], references: [id])

  @@unique([email, provider])
  @@index([user_id])
  @@map("oauth_tokens")
}

model password_resets {
  id         String    @id @default(uuid()) @db.Uuid
  email      String
  token      String    @unique
  expires_at DateTime  @db.Timestamptz(6)
  used_at    DateTime? @db.Timestamptz(6)
  created_at DateTime  @default(now()) @db.Timestamptz(6)

  @@index([email])
  @@map("password_resets")
}

model theme_overrides {
  user_id    String    @id @db.Uuid
  theme_key  String    @db.VarChar(64)
  variant    String    @db.VarChar(16)
  expires_at DateTime? @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  user       users     @relation(fields: [user_id], references: [id])

  @@map("theme_overrides")
}
